(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[593],{898:(e,s,a)=>{Promise.resolve().then(a.bind(a,2154))},2154:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>eV,dynamic:()=>eW});var t=a(3365),r=a(1521),n=a(4584),i=a(2292);function l(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,i.QP)((0,n.$)(s))}function c(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card",className:l("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-header",className:l("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...a})}function o(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-title",className:l("leading-none font-semibold",s),...a})}function m(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-description",className:l("text-muted-foreground text-sm",s),...a})}function h(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-content",className:l("px-6",s),...a})}var u=a(2934);let x=(0,u.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}}),p=r.forwardRef((e,s)=>{let{className:a,variant:r,size:n,...i}=e;return(0,t.jsx)("button",{ref:s,"data-slot":"button",className:l(x({variant:r,size:n,className:a})),...i})});p.displayName="Button";let g=(0,u.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function v(e){let{className:s,variant:a,...r}=e;return(0,t.jsx)("div",{className:l(g({variant:a}),s),...r})}var j=a(9361);function f(e){let{className:s,...a}=e;return(0,t.jsx)(j.bL,{"data-slot":"tabs",className:l("flex flex-col gap-2",s),...a})}function y(e){let{className:s,...a}=e;return(0,t.jsx)(j.B8,{"data-slot":"tabs-list",className:l("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...a})}function N(e){let{className:s,...a}=e;return(0,t.jsx)(j.l9,{"data-slot":"tabs-trigger",className:l("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...a})}function b(e){let{className:s,...a}=e;return(0,t.jsx)(j.UC,{"data-slot":"tabs-content",className:l("flex-1 outline-none",s),...a})}function w(e){var s,a;return{id:(null===(s=e._id)||void 0===s?void 0:s.toString())||e._id,campaignId:(null===(a=e.campaignId)||void 0===a?void 0:a.toString())||e.campaignId,name:e.name,type:e.type,description:e.description,difficulty:e.difficulty||"Medium",inhabitants:e.inhabitants||[],connections:e.connections||[],createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}}function C(e){var s,a;return{id:(null===(s=e._id)||void 0===s?void 0:s.toString())||e._id,campaignId:(null===(a=e.campaignId)||void 0===a?void 0:a.toString())||e.campaignId,title:e.title||"Session ".concat(e.sessionNumber),name:e.name,description:e.description||"Session ".concat(e.sessionNumber),date:new Date(e.date),isCompleted:e.isCompleted||!1,sessionNumber:e.sessionNumber,isActive:e.isActive||!1,status:e.status||"In Progress",duration:e.duration,summary:e.summary,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}}var k=a(4089);class A{async request(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={"Cache-Control":"no-cache",Pragma:"no-cache",...s.headers||{}};s.method&&["POST","PUT","PATCH"].includes(s.method)&&(a["Content-Type"]="application/json");let t={headers:a,cache:"no-store",...s};try{let s=await fetch("/api".concat(e),t);if(!s.ok)throw Error("HTTP error! status: ".concat(s.status));return await s.json()}catch(s){throw console.error("API request failed for ".concat(e,":"),s),s}}async getCampaigns(){return await this.request("/campaigns")}async getCampaign(e){return await this.request("/campaigns/".concat(e))}async createCampaign(e){return await this.request("/campaigns",{method:"POST",body:JSON.stringify(e)})}async updateCampaign(e,s){return this.request("/campaigns/".concat(e),{method:"PUT",body:JSON.stringify(s)})}async deleteCampaign(e){return this.request("/campaigns/".concat(e),{method:"DELETE"})}async initializeCampaign(e,s,a){return await this.request("/campaigns/".concat(e,"/initialize"),{method:"POST",body:JSON.stringify({sessionId:s,characterIds:a})})}async getCharacters(){return[]}async getCharactersByCampaign(e){return await this.request("/characters/campaign/".concat(e))}async getCharacter(e){return await this.request("/characters/".concat(e))}async createCharacter(e){return this.request("/characters/simple",{method:"POST",body:JSON.stringify(e)})}async updateCharacter(e,s){let a=k.env.BACKEND_URL||k.env.NEXT_PUBLIC_API_URL;if(!a)throw Error("BACKEND_URL or NEXT_PUBLIC_API_URL environment variable is required");let t=await fetch("".concat(a,"/api/characters/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Pragma:"no-cache"},body:JSON.stringify(s)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}async deleteCharacter(e){return this.request("/characters/".concat(e),{method:"DELETE"})}async getSessionsByCampaign(e){return(await this.request("/sessions/campaign/".concat(e))).sessions.map(C)}async getSession(e){return C(await this.request("/sessions/".concat(e)))}async createSession(e){return this.request("/sessions",{method:"POST",body:JSON.stringify(e)})}async updateSession(e,s){return this.request("/sessions/".concat(e),{method:"PUT",body:JSON.stringify(s)})}async deleteSession(e){return this.request("/sessions/".concat(e),{method:"DELETE"})}async createAutomaticSession(e,s,a){return this.request("/sessions/auto-create",{method:"POST",body:JSON.stringify({campaignId:e,characterId:s,sessionId:a})})}async updateSessionActivity(e){return this.request("/sessions/".concat(e,"/activity"),{method:"POST"})}async closeInactiveSessions(){return this.request("/sessions/close-inactive",{method:"POST"})}async getLocations(){return[]}async getLocationsByCampaign(e){var s;return(null===(s=(await this.request("/locations/campaign/".concat(e))).locations)||void 0===s?void 0:s.map(w))||[]}async getLocation(e){return w(await this.request("/locations/".concat(e)))}async createLocation(e){return this.request("/locations",{method:"POST",body:JSON.stringify(e)})}async updateLocation(e,s){let a=k.env.BACKEND_URL||k.env.NEXT_PUBLIC_API_URL;if(!a)throw Error("BACKEND_URL or NEXT_PUBLIC_API_URL environment variable is required");let t=await fetch("".concat(a,"/api/locations/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json","Cache-Control":"no-cache",Pragma:"no-cache"},body:JSON.stringify(s)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}async deleteLocation(e){return this.request("/locations/".concat(e),{method:"DELETE"})}}let S=new A;function P(e){let{className:s,type:a,...r}=e;return(0,t.jsx)("input",{type:a,"data-slot":"input",className:l("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...r})}var I=a(8824);function L(e){let{className:s,...a}=e;return(0,t.jsx)(I.b,{"data-slot":"label",className:l("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...a})}let E=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("textarea",{className:l("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:s,...r})});E.displayName="Textarea";var D=a(968),T=a(2446),F=a(1e3),U=a(7811);function M(e){let{...s}=e;return(0,t.jsx)(D.bL,{"data-slot":"select",...s})}function B(e){let{...s}=e;return(0,t.jsx)(D.WT,{"data-slot":"select-value",...s})}function _(e){let{className:s,size:a="default",children:r,...n}=e;return(0,t.jsxs)(D.l9,{"data-slot":"select-trigger","data-size":a,className:l("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...n,children:[r,(0,t.jsx)(D.In,{asChild:!0,children:(0,t.jsx)(T.A,{className:"size-4 opacity-50"})})]})}function z(e){let{className:s,children:a,position:r="popper",...n}=e;return(0,t.jsx)(D.ZL,{children:(0,t.jsxs)(D.UC,{"data-slot":"select-content",className:l("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,...n,children:[(0,t.jsx)(R,{}),(0,t.jsx)(D.LM,{className:l("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,t.jsx)(O,{})]})})}function q(e){let{className:s,children:a,...r}=e;return(0,t.jsxs)(D.q7,{"data-slot":"select-item",className:l("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...r,children:[(0,t.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,t.jsx)(D.VF,{children:(0,t.jsx)(F.A,{className:"size-4"})})}),(0,t.jsx)(D.p4,{children:a})]})}function R(e){let{className:s,...a}=e;return(0,t.jsx)(D.PP,{"data-slot":"select-scroll-up-button",className:l("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(U.A,{className:"size-4"})})}function O(e){let{className:s,...a}=e;return(0,t.jsx)(D.wn,{"data-slot":"select-scroll-down-button",className:l("flex cursor-default items-center justify-center py-1",s),...a,children:(0,t.jsx)(T.A,{className:"size-4"})})}let H=(0,u.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function W(e){let{className:s,variant:a,...r}=e;return(0,t.jsx)("div",{"data-slot":"alert",role:"alert",className:l(H({variant:a}),s),...r})}function V(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"alert-description",className:l("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...a})}var Y=a(5842),J=a(9703),X=a(3678),G=a(3441),K=a(2196);let Q=[{value:"fantasy",label:"Fantasy"},{value:"sci-fi",label:"Sci-Fi"},{value:"horror",label:"Horror"},{value:"mystery",label:"Mystery"},{value:"western",label:"Western"},{value:"cyberpunk",label:"Cyberpunk"},{value:"steampunk",label:"Steampunk"},{value:"post-apocalyptic",label:"Post-Apocalyptic"},{value:"medieval",label:"Medieval"},{value:"modern",label:"Modern"},{value:"futuristic",label:"Futuristic"},{value:"space",label:"Space"},{value:"underwater",label:"Underwater"},{value:"desert",label:"Desert"},{value:"arctic",label:"Arctic"},{value:"tropical",label:"Tropical"}];function Z(e){var s;let{campaign:a,onSave:n,onCancel:i,isSaving:l}=e,[u,x]=(0,r.useState)({name:(null==a?void 0:a.name)||"",description:(null==a?void 0:a.description)||"",theme:(null==a?void 0:a.theme)||"",status:null!==(s=null==a?void 0:a.status)&&void 0!==s?s:"active",createdBy:"player"}),[g,j]=(0,r.useState)(!1),[f,y]=(0,r.useState)("idle"),[N,b]=(0,r.useState)(""),w=void 0!==l?l:g,C=async e=>{if(e.preventDefault(),void 0!==l){n({...u,id:null==a?void 0:a.id,createdAt:null==a?void 0:a.createdAt,updatedAt:new Date});return}try{j(!0),y("idle"),b(""),await n({...u,id:null==a?void 0:a.id,createdAt:null==a?void 0:a.createdAt,updatedAt:new Date}),y("success"),b(a?"Campaign updated successfully!":"Campaign created successfully!"),setTimeout(()=>{y("idle"),b("")},3e3)}catch(e){y("error"),b(e instanceof Error?e.message:"Failed to save campaign"),setTimeout(()=>{y("error"),b("")},5e3)}finally{j(!1)}};return(0,t.jsxs)(c,{className:"w-full max-w-2xl mx-auto",children:[(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{children:a?"Edit Campaign":"Create New Campaign"}),(0,t.jsx)(m,{children:a?"Update your campaign details":"Set up a new D&D adventure"})]}),(0,t.jsxs)(h,{children:["success"===f&&(0,t.jsxs)(W,{className:"mb-4 border-green-200 bg-green-50",children:[(0,t.jsx)(Y.A,{className:"h-4 w-4 text-green-600"}),(0,t.jsx)(V,{className:"text-green-800",children:N})]}),"error"===f&&(0,t.jsxs)(W,{className:"mb-4 border-red-200 bg-red-50",children:[(0,t.jsx)(J.A,{className:"h-4 w-4 text-red-600"}),(0,t.jsx)(V,{className:"text-red-800",children:N})]}),(0,t.jsxs)("form",{onSubmit:C,className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"name",children:"Campaign Name"}),(0,t.jsx)(P,{id:"name",value:u.name,onChange:e=>x({...u,name:e.target.value}),placeholder:"Enter campaign name...",required:!0,disabled:w})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"description",children:"Description"}),(0,t.jsx)(E,{id:"description",value:u.description,onChange:e=>x({...u,description:e.target.value}),placeholder:"Describe your campaign...",rows:4,required:!0,disabled:w})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"theme",children:"Campaign Theme"}),(0,t.jsxs)(M,{value:u.theme,onValueChange:e=>x({...u,theme:e}),required:!0,disabled:w,children:[(0,t.jsx)(_,{children:(0,t.jsx)(B,{placeholder:"Select a campaign theme..."})}),(0,t.jsx)(z,{children:Q.map(e=>(0,t.jsx)(q,{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"status",checked:"active"===u.status,onChange:e=>x({...u,status:e.target.checked?"active":"paused"}),className:"rounded border-border",disabled:w}),(0,t.jsx)(L,{htmlFor:"status",children:"Active Campaign"}),(0,t.jsx)(v,{variant:"active"===u.status?"default":"secondary",children:"active"===u.status?"Active":"Paused"})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsx)(p,{type:"submit",className:"flex-1",disabled:w,children:w?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.A,{className:"h-4 w-4 mr-2 animate-spin"}),a?"Updating...":"Creating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(G.A,{className:"h-4 w-4 mr-2"}),a?"Update Campaign":"Create Campaign"]})}),(0,t.jsxs)(p,{type:"button",variant:"outline",onClick:i,disabled:w,children:[(0,t.jsx)(K.A,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})]})]})}var $=a(2364);let ee=["Human","Elf","Dwarf","Halfling","Dragonborn","Gnome","Half-Elf","Half-Orc","Tiefling","Aasimar","Genasi","Goliath","Tabaxi"],es=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard","Artificer"],ea=["Acolyte","Criminal","Folk Hero","Noble","Sage","Soldier","Charlatan","Entertainer","Guild Artisan","Hermit","Outlander","Sailor"],et=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],er=["Acrobatics","Animal Handling","Arcana","Athletics","Deception","History","Insight","Intimidation","Investigation","Medicine","Nature","Perception","Performance","Persuasion","Religion","Sleight of Hand","Stealth","Survival"];function en(e){var s,a,n,i,l,u;let{character:x,onSave:g,onCancel:j,campaignId:w,sessionId:C,isSaving:k,campaigns:A}=e,[S,I]=(0,r.useState)({name:(null==x?void 0:x.name)||"",race:(null==x?void 0:x.race)||"",class:(null==x?void 0:x.class)||"",level:(null==x?void 0:x.level)||1,background:(null==x?void 0:x.background)||"",alignment:(null==x?void 0:x.alignment)||"",currentLocation:(null==x?void 0:x.currentLocation)||"",hitPoints:{current:(null==x?void 0:null===(s=x.hitPoints)||void 0===s?void 0:s.current)||8,maximum:(null==x?void 0:null===(a=x.hitPoints)||void 0===a?void 0:a.maximum)||8},armorClass:(null==x?void 0:x.armorClass)||10,attributes:(null==x?void 0:x.attributes)||{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},skills:(null==x?void 0:x.skills)||[],traits:(null==x?void 0:null===(n=x.personality)||void 0===n?void 0:n.traits)||[],ideals:(null==x?void 0:null===(i=x.personality)||void 0===i?void 0:i.ideals)||[],bonds:(null==x?void 0:null===(l=x.personality)||void 0===l?void 0:l.bonds)||[],flaws:(null==x?void 0:null===(u=x.personality)||void 0===u?void 0:u.flaws)||[],equipment:(null==x?void 0:x.equipment)||[],spells:(null==x?void 0:x.spells)||[],backstory:(null==x?void 0:x.backstory)||""}),[D,T]=(0,r.useState)(w||""),[F,U]=(0,r.useState)(!w&&!!(null==A?void 0:A.length)),R=e=>Math.floor((e-10)/2),O=e=>{let s=S.skills.includes(e)?S.skills.filter(s=>s!==e):[...S.skills,e];I({...S,skills:s})};return(0,t.jsxs)(c,{className:"w-full max-w-4xl mx-auto",children:[(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{children:x?"Edit Character":"Create New Character"}),(0,t.jsx)(m,{children:x?"Update your character details":"Build your D&D character"})]}),(0,t.jsx)(h,{children:(0,t.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!D){alert("Please select a campaign for your character");return}g({...S,id:(null==x?void 0:x.id)||crypto.randomUUID(),createdAt:(null==x?void 0:x.createdAt)||new Date,updatedAt:new Date,campaignId:D,sessionId:C||"",createdBy:"user",attributes:S.attributes,personality:{traits:S.traits,ideals:S.ideals,bonds:S.bonds,flaws:S.flaws,background:S.background,alignment:S.alignment}})},className:"space-y-6",children:[F&&A&&A.length>0&&(0,t.jsx)("div",{className:"space-y-4 p-4 border rounded-lg bg-muted/50",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"campaign",children:"Select Campaign"}),(0,t.jsxs)(M,{value:D,onValueChange:T,children:[(0,t.jsx)(_,{children:(0,t.jsx)(B,{placeholder:"Choose a campaign for your character"})}),(0,t.jsx)(z,{children:A.map(e=>(0,t.jsx)(q,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsx)(v,{variant:"outline",className:"text-xs",children:e.theme||"Custom"})]})},e.id))})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your character will be created in the selected campaign world."})]})}),(0,t.jsxs)(f,{defaultValue:"basic",className:"space-y-4",children:[(0,t.jsxs)(y,{className:"grid w-full grid-cols-4",children:[(0,t.jsx)(N,{value:"basic",children:"Basic Info"}),(0,t.jsx)(N,{value:"stats",children:"Stats & Skills"}),(0,t.jsx)(N,{value:"personality",children:"Personality"}),(0,t.jsx)(N,{value:"equipment",children:"Equipment"}),(0,t.jsx)(N,{value:"backstory",children:"Backstory"})]}),(0,t.jsxs)(b,{value:"basic",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"name",children:"Character Name"}),(0,t.jsx)(P,{id:"name",value:S.name,onChange:e=>I({...S,name:e.target.value}),placeholder:"Enter character name...",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"level",children:"Level"}),(0,t.jsx)(P,{id:"level",type:"number",min:"1",max:"20",value:S.level,onChange:e=>I({...S,level:Number.parseInt(e.target.value)||1})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"race",children:"Race"}),(0,t.jsxs)(M,{value:S.race,onValueChange:e=>I({...S,race:e}),children:[(0,t.jsx)(_,{children:(0,t.jsx)(B,{placeholder:"Select race..."})}),(0,t.jsx)(z,{children:ee.map(e=>(0,t.jsx)(q,{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"class",children:"Class"}),(0,t.jsxs)(M,{value:S.class,onValueChange:e=>I({...S,class:e}),children:[(0,t.jsx)(_,{children:(0,t.jsx)(B,{placeholder:"Select class..."})}),(0,t.jsx)(z,{children:es.map(e=>(0,t.jsx)(q,{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"background",children:"Background"}),(0,t.jsxs)(M,{value:S.background,onValueChange:e=>I({...S,background:e}),children:[(0,t.jsx)(_,{children:(0,t.jsx)(B,{placeholder:"Select background..."})}),(0,t.jsx)(z,{children:ea.map(e=>(0,t.jsx)(q,{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"alignment",children:"Alignment"}),(0,t.jsxs)(M,{value:S.alignment,onValueChange:e=>I({...S,alignment:e}),children:[(0,t.jsx)(_,{children:(0,t.jsx)(B,{placeholder:"Select alignment..."})}),(0,t.jsx)(z,{children:et.map(e=>(0,t.jsx)(q,{value:e,children:e},e))})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"currentLocation",children:"Current Location"}),(0,t.jsx)(P,{id:"currentLocation",value:S.currentLocation,onChange:e=>I({...S,currentLocation:e.target.value}),placeholder:"Where is your character currently located?"})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"hp-current",children:"Current HP"}),(0,t.jsx)(P,{id:"hp-current",type:"number",min:"0",value:S.hitPoints.current,onChange:e=>I({...S,hitPoints:{...S.hitPoints,current:Number.parseInt(e.target.value)||0}})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"hp-max",children:"Maximum HP"}),(0,t.jsx)(P,{id:"hp-max",type:"number",min:"1",value:S.hitPoints.maximum,onChange:e=>I({...S,hitPoints:{...S.hitPoints,maximum:Number.parseInt(e.target.value)||1}})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"ac",children:"Armor Class"}),(0,t.jsx)(P,{id:"ac",type:"number",min:"1",value:S.armorClass,onChange:e=>I({...S,armorClass:Number.parseInt(e.target.value)||10})})]})]})]}),(0,t.jsxs)(b,{value:"stats",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Ability Scores"}),(0,t.jsxs)(p,{type:"button",variant:"outline",onClick:()=>{let e=()=>{let e=Array.from({length:4},()=>Math.floor(6*Math.random())+1);return e.sort((e,s)=>s-e),e.slice(0,3).reduce((e,s)=>e+s,0)};I({...S,attributes:{strength:e(),dexterity:e(),constitution:e(),intelligence:e(),wisdom:e(),charisma:e()}})},children:[(0,t.jsx)($.A,{className:"h-4 w-4 mr-2"}),"Roll Stats"]})]}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:Object.entries(S.attributes).map(e=>{let[s,a]=e;return(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:s,className:"capitalize",children:s}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(P,{id:s,type:"number",min:"1",max:"20",value:a,onChange:e=>I({...S,attributes:{...S.attributes,[s]:Number.parseInt(e.target.value)||10}}),className:"flex-1"}),(0,t.jsxs)("div",{className:"w-16 flex items-center justify-center bg-muted rounded-md text-sm font-medium",children:[R(a)>=0?"+":"",R(a)]})]})]},s)})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Skills"}),(0,t.jsx)("div",{className:"grid gap-2 md:grid-cols-3",children:er.map(e=>(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:e,checked:S.skills.includes(e),onChange:()=>O(e),className:"rounded border-border"}),(0,t.jsx)(L,{htmlFor:e,className:"text-sm",children:e})]},e))})]})]}),(0,t.jsx)(b,{value:"personality",className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"traits",children:"Traits"}),(0,t.jsx)(E,{id:"traits",value:S.traits,onChange:e=>I({...S,traits:e.target.value.split(",").map(e=>e.trim()).filter(e=>e)}),placeholder:"Describe your character's personality traits...",rows:3})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"ideals",children:"Ideals"}),(0,t.jsx)(E,{id:"ideals",value:S.ideals,onChange:e=>I({...S,ideals:e.target.value.split(",").map(e=>e.trim()).filter(e=>e)}),placeholder:"What ideals drive your character?",rows:3})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"bonds",children:"Bonds"}),(0,t.jsx)(E,{id:"bonds",value:S.bonds,onChange:e=>I({...S,bonds:e.target.value.split(",").map(e=>e.trim()).filter(e=>e)}),placeholder:"What bonds connect your character to the world?",rows:3})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"flaws",children:"Flaws"}),(0,t.jsx)(E,{id:"flaws",value:S.flaws,onChange:e=>I({...S,flaws:e.target.value.split(",").map(e=>e.trim()).filter(e=>e)}),placeholder:"What flaws or weaknesses does your character have?",rows:3})]})]})}),(0,t.jsxs)(b,{value:"equipment",className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"equipment",children:"Equipment (one per line)"}),(0,t.jsx)(E,{id:"equipment",value:(S.equipment||[]).join("\n"),onChange:e=>I({...S,equipment:e.target.value.split("\n").filter(e=>e.trim())}),placeholder:"Longsword Chain Mail Shield Backpack",rows:8})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"spells",children:"Spells (one per line)"}),(0,t.jsx)(E,{id:"spells",value:(S.spells||[]).join("\n"),onChange:e=>I({...S,spells:e.target.value.split("\n").filter(e=>e.trim())}),placeholder:"Magic Missile Shield Cure Wounds",rows:6})]})]}),(0,t.jsx)(b,{value:"backstory",className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"backstory",children:"Character Backstory"}),(0,t.jsx)(E,{id:"backstory",value:S.backstory,onChange:e=>I({...S,backstory:e.target.value}),placeholder:"Tell your character's story...",rows:10})]})})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsx)(p,{type:"submit",className:"flex-1",disabled:k,children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.A,{className:"h-4 w-4 mr-2 animate-spin"}),x?"Updating...":"Creating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(G.A,{className:"h-4 w-4 mr-2"}),x?"Update Character":"Create Character"]})}),(0,t.jsxs)(p,{type:"button",variant:"outline",onClick:j,disabled:k,children:[(0,t.jsx)(K.A,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})})]})}let ei=r.forwardRef((e,s)=>{let{className:a,value:r,...n}=e;return(0,t.jsx)("div",{ref:s,className:l("relative h-2 w-full overflow-hidden rounded-full bg-secondary",a),...n,children:(0,t.jsx)("div",{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});ei.displayName="Progress";var el=a(8096),ec=a(3385),ed=a(5852),eo=a(2393),em=a(5655),eh=a(7931),eu=a(4369),ex=a(2205);function ep(e){let{character:s,onEdit:a}=e,r=e=>{let s=Math.floor((e-10)/2);return s>=0?"+".concat(s):"".concat(s)},n=s.hitPoints.current/s.hitPoints.maximum*100;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(c,{children:(0,t.jsx)(d,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsx)("div",{className:"flex gap-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(o,{className:"text-2xl",children:s.name}),(0,t.jsxs)(m,{className:"text-lg",children:["Level ",s.level," ",s.race," ",s.class]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(v,{variant:"outline",children:s.background}),(0,t.jsx)(v,{variant:"secondary",children:s.alignment}),s.currentLocation&&(0,t.jsxs)(v,{variant:"outline",className:"flex items-center gap-1",children:[(0,t.jsx)(el.A,{className:"h-3 w-3"}),s.currentLocation]})]})]})}),a&&(0,t.jsxs)(p,{variant:"outline",onClick:a,children:[(0,t.jsx)(ec.A,{className:"h-4 w-4 mr-2"}),"Edit"]})]})})}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{className:"pb-3",children:(0,t.jsxs)(o,{className:"text-sm font-medium flex items-center gap-2",children:[(0,t.jsx)(ed.A,{className:"h-4 w-4 text-red-500"}),"Hit Points"]})}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-2xl font-bold",children:s.hitPoints.current}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["/ ",s.hitPoints.maximum]})]}),(0,t.jsx)(ei,{value:n,className:"h-2"})]})})]}),(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{className:"pb-3",children:(0,t.jsxs)(o,{className:"text-sm font-medium flex items-center gap-2",children:[(0,t.jsx)(eo.A,{className:"h-4 w-4 text-blue-500"}),"Armor Class"]})}),(0,t.jsx)(h,{children:(0,t.jsx)("div",{className:"text-2xl font-bold",children:s.armorClass})})]}),(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{className:"pb-3",children:(0,t.jsxs)(o,{className:"text-sm font-medium flex items-center gap-2",children:[(0,t.jsx)(em.A,{className:"h-4 w-4 text-yellow-500"}),"Proficiency Bonus"]})}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"text-2xl font-bold",children:["+",s.proficiencyBonus]})})]})]}),(0,t.jsxs)(f,{defaultValue:"stats",className:"space-y-4",children:[(0,t.jsxs)(y,{className:"grid w-full grid-cols-4",children:[(0,t.jsxs)(N,{value:"stats",className:"flex items-center gap-2",children:[(0,t.jsx)(eh.A,{className:"h-4 w-4"}),"Stats"]}),(0,t.jsxs)(N,{value:"skills",className:"flex items-center gap-2",children:[(0,t.jsx)(em.A,{className:"h-4 w-4"}),"Skills"]}),(0,t.jsxs)(N,{value:"equipment",className:"flex items-center gap-2",children:[(0,t.jsx)(eu.A,{className:"h-4 w-4"}),"Equipment"]}),(0,t.jsxs)(N,{value:"backstory",className:"flex items-center gap-2",children:[(0,t.jsx)(ex.A,{className:"h-4 w-4"}),"Backstory"]})]}),(0,t.jsx)(b,{value:"stats",children:(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{children:"Ability Scores"})}),(0,t.jsx)(h,{children:(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:Object.entries(s.stats).map(e=>{let[s,a]=e;return(0,t.jsxs)("div",{className:"text-center p-4 bg-muted rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-muted-foreground capitalize mb-1",children:s}),(0,t.jsx)("div",{className:"text-2xl font-bold mb-1",children:a}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:r(a)})]},s)})})})]})}),(0,t.jsx)(b,{value:"skills",children:(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{children:"Proficient Skills"}),(0,t.jsx)(m,{children:"Skills your character is trained in"})]}),(0,t.jsx)(h,{children:s.skills.length>0?(0,t.jsx)("div",{className:"grid gap-2 md:grid-cols-2",children:s.skills.map(e=>(0,t.jsx)(v,{variant:"secondary",className:"justify-start",children:e},e))}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"No proficient skills selected."})})]})}),(0,t.jsxs)(b,{value:"equipment",className:"space-y-4",children:[(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{children:"Equipment"})}),(0,t.jsx)(h,{children:s.equipment.length>0?(0,t.jsx)("div",{className:"space-y-2",children:s.equipment.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[(0,t.jsx)(eu.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{children:e})]},s))}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"No equipment listed."})})]}),s.spells&&s.spells.length>0&&(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{children:"Spells"})}),(0,t.jsx)(h,{children:(0,t.jsx)("div",{className:"space-y-2",children:s.spells.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[(0,t.jsx)(ex.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{children:e})]},s))})})]})]}),(0,t.jsx)(b,{value:"backstory",children:(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{children:"Character Backstory"})}),(0,t.jsx)(h,{children:s.backstory?(0,t.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,t.jsx)("p",{className:"whitespace-pre-wrap",children:s.backstory})}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"No backstory written yet."})})]})})]})]})}var eg=a(3060);let ev=[{value:"settlement",label:"Settlement",description:"Towns, villages, and urban settlements"},{value:"dungeon",label:"Dungeon",description:"Caves, ruins, and underground complexes"},{value:"wilderness",label:"Wilderness",description:"Forests, mountains, and natural areas"},{value:"landmark",label:"Landmark",description:"Notable natural or constructed features"},{value:"shop",label:"Shop",description:"Merchant establishments and markets"},{value:"tavern",label:"Tavern",description:"Inns, pubs, and social gathering places"},{value:"temple",label:"Temple",description:"Religious buildings and sacred sites"},{value:"castle",label:"Castle",description:"Fortresses, palaces, and strongholds"},{value:"other",label:"Other",description:"Unique or special locations"}];function ej(e){let{location:s,onSave:a,onCancel:n,availableLocations:i=[],campaignId:l,sessionId:u,isSaving:x}=e,[g,j]=(0,r.useState)({name:(null==s?void 0:s.name)||"",type:(null==s?void 0:s.type)||"settlement",description:(null==s?void 0:s.description)||"",inhabitants:(null==s?void 0:s.inhabitants)||[],connections:(null==s?void 0:s.connections)||[]}),[f,y]=(0,r.useState)(""),[N,b]=(0,r.useState)(""),w=()=>{f.trim()&&(j({...g,inhabitants:[...g.inhabitants,f.trim()]}),y(""))},C=e=>{j({...g,inhabitants:g.inhabitants.filter((s,a)=>a!==e)})},k=e=>{j({...g,connections:g.connections.filter(s=>s!==e)})},A=e=>{let s=i.find(s=>s.id===e);return s?s.name:"Unknown Location"},S=i.filter(e=>e.id!==(null==s?void 0:s.id)&&!g.connections.includes(e.id));return(0,t.jsxs)(c,{className:"w-full max-w-2xl mx-auto",children:[(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{children:s?"Edit Location":"Create New Location"}),(0,t.jsx)(m,{children:s?"Update your location details":"Build a new location for your world"})]}),(0,t.jsx)(h,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a({...g,campaignId:l,...u&&{sessionId:u},createdBy:"player"})},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"name",children:"Location Name"}),(0,t.jsx)(P,{id:"name",value:g.name,onChange:e=>j({...g,name:e.target.value}),placeholder:"Enter location name...",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"type",children:"Location Type"}),(0,t.jsxs)(M,{value:g.type,onValueChange:e=>j({...g,type:e}),children:[(0,t.jsx)(_,{children:(0,t.jsx)(B,{placeholder:"Choose location type"})}),(0,t.jsx)(z,{children:ev.map(e=>(0,t.jsx)(q,{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{htmlFor:"description",children:"Description"}),(0,t.jsx)(E,{id:"description",value:g.description,onChange:e=>j({...g,description:e.target.value}),placeholder:"Describe this location...",rows:4,required:!0})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(L,{children:"Inhabitants"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(P,{value:f,onChange:e=>y(e.target.value),placeholder:"Add inhabitant name...",onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),w())}),(0,t.jsx)(p,{type:"button",onClick:w,size:"sm",children:(0,t.jsx)(eg.A,{className:"h-4 w-4"})})]}),g.inhabitants.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Current inhabitants:"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:g.inhabitants.map((e,s)=>(0,t.jsxs)(v,{variant:"secondary",className:"flex items-center gap-1",children:[e,(0,t.jsx)("button",{type:"button",onClick:()=>C(s),className:"ml-1 hover:text-destructive",children:(0,t.jsx)(K.A,{className:"h-3 w-3"})})]},s))})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(L,{children:"Connected Locations"}),S.length>0&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(M,{value:N,onValueChange:b,children:[(0,t.jsx)(_,{className:"flex-1",children:(0,t.jsx)(B,{placeholder:"Select location to connect..."})}),(0,t.jsx)(z,{children:S.map(e=>(0,t.jsxs)(q,{value:e.id,children:[e.name," (",e.type,")"]},e.id))})]}),(0,t.jsx)(p,{type:"button",onClick:()=>{N&&!g.connections.includes(N)&&(j({...g,connections:[...g.connections,N]}),b(""))},size:"sm",disabled:!N,children:(0,t.jsx)(eg.A,{className:"h-4 w-4"})})]}),g.connections.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Connected to:"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:g.connections.map(e=>(0,t.jsxs)(v,{variant:"outline",className:"flex items-center gap-1",children:[A(e),(0,t.jsx)("button",{type:"button",onClick:()=>k(e),className:"ml-1 hover:text-destructive",children:(0,t.jsx)(K.A,{className:"h-3 w-3"})})]},e))})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsx)(p,{type:"submit",className:"flex-1",disabled:x,children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.A,{className:"h-4 w-4 mr-2 animate-spin"}),s?"Updating...":"Creating..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(G.A,{className:"h-4 w-4 mr-2"}),s?"Update Location":"Create Location"]})}),(0,t.jsxs)(p,{type:"button",variant:"outline",onClick:n,disabled:x,children:[(0,t.jsx)(K.A,{className:"h-4 w-4 mr-2"}),"Cancel"]})]})]})})]})}var ef=a(1941),ey=a(7216),eN=a(5760);let eb=e=>{switch(e){case"city":return"\uD83C\uDFD8ï¸";case"dungeon":return"\uD83C\uDFF0";case"wilderness":return"\uD83C\uDF32";case"building":return"\uD83C\uDFE2";default:return"\uD83D\uDCCD"}},ew=e=>{switch(e){case"city":return"bg-blue-500";case"dungeon":return"bg-red-500";case"wilderness":return"bg-green-500";case"building":return"bg-yellow-500";default:return"bg-gray-500"}};function eC(e){let{location:s,onBack:a,onEdit:r,allLocations:n=[]}=e,i=e=>{let s=n.find(s=>s.id===e);return s?s.name:"Unknown Location"},l=e=>{let s=n.find(s=>s.id===e);return s?s.type:"unknown"};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)(p,{variant:"outline",size:"sm",onClick:a,children:[(0,t.jsx)(ef.A,{className:"h-4 w-4 mr-2"}),"Back to Locations"]}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg ".concat(ew(s.type)),children:(0,t.jsx)(el.A,{className:"h-6 w-6 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:s.name}),(0,t.jsxs)(v,{variant:"outline",className:"capitalize",children:[eb(s.type)," ",s.type]})]})]})}),(0,t.jsxs)(p,{variant:"outline",onClick:r,children:[(0,t.jsx)(ec.A,{className:"h-4 w-4 mr-2"}),"Edit Location"]})]}),(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{children:"Location Overview"})}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"Description"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:s.description})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"Location Details"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Type:"}),(0,t.jsx)(v,{variant:"outline",className:"capitalize",children:s.type})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Created:"}),(0,t.jsx)("span",{children:s.createdAt.toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Last Updated:"}),(0,t.jsx)("span",{children:s.updatedAt.toLocaleDateString()})]})]})]})})]})})]}),(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(ey.A,{className:"h-5 w-5"}),"Inhabitants"]}),(0,t.jsx)(m,{children:"Notable people and creatures in this location"})]}),(0,t.jsx)(h,{children:s.inhabitants&&s.inhabitants.length>0?(0,t.jsx)("div",{className:"space-y-2",children:s.inhabitants.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[(0,t.jsx)(ey.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{children:e})]},s))}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"No inhabitants listed for this location."})})]}),(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(eN.A,{className:"h-5 w-5"}),"Connected Locations"]}),(0,t.jsx)(m,{children:"Places accessible from this location"})]}),(0,t.jsx)(h,{children:s.connections&&s.connections.length>0?(0,t.jsx)("div",{className:"space-y-2",children:s.connections.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[(0,t.jsx)("div",{className:"p-1 rounded ".concat(ew(l(e))),children:(0,t.jsx)(el.A,{className:"h-3 w-3 text-white"})}),(0,t.jsx)("span",{children:i(e)}),(0,t.jsx)(v,{variant:"outline",className:"ml-auto capitalize text-xs",children:l(e)})]},e))}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"This location has no connections to other places."})})]})]}),(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{children:"Adventure Hooks & Notes"}),(0,t.jsx)(m,{children:"Ideas for adventures and important details"})]}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(el.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Adventure hooks and notes coming soon..."})]})})]})]})}var ek=a(7521),eA=a(3966),eS=a(3697),eP=a(4089);function eI(e){var s,a,n,i,l,u,x,g,j,w,C,k,A,S,P,I,L,E,D,T;let{campaign:F,characters:U,locations:M,onBack:B,onEdit:_,onPlaySession:z,onSaveCharacter:q,onSaveLocation:R,onDeleteCampaign:O}=e,[H,W]=(0,r.useState)(null),[V,Y]=(0,r.useState)(null),[J,X]=(0,r.useState)("list"),[G,K]=(0,r.useState)("list"),[Q,Z]=(0,r.useState)(F.settings||{difficulty:"medium",maxLevel:20,startingLevel:1,experienceRate:"normal",magicLevel:"medium",technologyLevel:"medieval",aiBehavior:{creativity:"medium",detailLevel:"moderate",pacing:"normal",combatStyle:"balanced"},playerSettings:{maxPlayers:6,allowNewPlayers:!0,playerPermissions:{canCreateCharacters:!0,canModifyWorld:!1,canManageSessions:!1}}}),[$,ee]=(0,r.useState)(!1),[es,ea]=(0,r.useState)(null),[et,er]=(0,r.useState)(null),[ei,ed]=(0,r.useState)(!1),[eo,em]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{let e=eP.env.NEXT_PUBLIC_API_URL;if(!e){console.error("NEXT_PUBLIC_API_URL environment variable is required");return}let s=await fetch("".concat(e,"/api/campaign-settings/").concat(F.id,"/settings"));if(s.ok){let e=await s.json();Z(e.settings||{})}}catch(e){console.error("Error loading campaign settings:",e)}})()},[F.id]);let eh=U.filter(e=>e.campaignId===F.id),eu=M.filter(e=>e.campaignId===F.id),ex=()=>{W(null),X("create")},ev=e=>{W(e),X("edit")},eN=e=>{W(e),X("view")},eb=async e=>{try{ed(!0),await q({...e,campaignId:F.id}),X("list"),W(null)}catch(e){console.error("Error saving character:",e)}finally{ed(!1)}},ew=()=>{Y(null),K("create")},eI=e=>{Y(e),K("edit")},eL=e=>{Y(e),K("view")},eE=async e=>{try{em(!0),await R({...e,campaignId:F.id}),K("list"),Y(null)}catch(e){console.error("Error saving location:",e)}finally{em(!1)}},eD=async()=>{try{ee(!0),ea(null),er(null);let e=eP.env.NEXT_PUBLIC_API_URL;if(!e)throw Error("NEXT_PUBLIC_API_URL environment variable is required");let s=await fetch("".concat(e,"/api/campaign-settings/").concat(F.id,"/settings"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:Q})});if(!s.ok)throw Error("Failed to save settings: ".concat(s.statusText));let a=await s.json();er("Settings saved successfully!"),Z(a.settings||{}),setTimeout(()=>er(null),3e3)}catch(e){console.error("Error saving settings:",e),ea(e instanceof Error?e.message:"Failed to save settings"),setTimeout(()=>ea(null),5e3)}finally{ee(!1)}},eT=(e,s,a)=>{Z(t=>{if(""===e)return{...t,[s]:a};{let r=t[e];return r&&"object"==typeof r?{...t,[e]:{...r,[s]:a}}:{...t,[e]:{[s]:a}}}})};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)(p,{variant:"outline",size:"sm",onClick:B,children:[(0,t.jsx)(ef.A,{className:"h-4 w-4 mr-2"}),"Back to Campaigns"]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:F.name}),(0,t.jsx)(v,{variant:"active"===F.status?"default":"secondary",children:"active"===F.status?"Active":F.status})]}),(0,t.jsx)("p",{className:"text-muted-foreground",children:F.theme})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(p,{variant:"outline",onClick:_,children:[(0,t.jsx)(ec.A,{className:"h-4 w-4 mr-2"}),"Edit Campaign"]}),O&&(0,t.jsxs)(p,{variant:"destructive",onClick:()=>O(F),children:[(0,t.jsx)(ek.A,{className:"h-4 w-4 mr-2"}),"Delete Campaign"]})]})]}),(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{children:"Campaign Overview"})}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"Description"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:F.description})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold mb-2",children:"Campaign Details"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Setting:"}),(0,t.jsx)("span",{children:F.theme})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Created:"}),(0,t.jsx)("span",{children:new Date(F.createdAt).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Last Updated:"}),(0,t.jsx)("span",{children:new Date(F.updatedAt).toLocaleDateString()})]})]})]})})]})})]}),(0,t.jsxs)(f,{defaultValue:"sessions",className:"space-y-4",children:[(0,t.jsxs)(y,{className:"grid w-full grid-cols-4",children:[(0,t.jsxs)(N,{value:"sessions",className:"flex items-center gap-2",children:[(0,t.jsx)(eA.A,{className:"h-4 w-4"}),"Sessions"]}),(0,t.jsxs)(N,{value:"characters",className:"flex items-center gap-2",children:[(0,t.jsx)(ey.A,{className:"h-4 w-4"}),"Characters"]}),(0,t.jsxs)(N,{value:"locations",className:"flex items-center gap-2",children:[(0,t.jsx)(el.A,{className:"h-4 w-4"}),"Locations"]}),(0,t.jsxs)(N,{value:"settings",className:"flex items-center gap-2",children:[(0,t.jsx)(eS.A,{className:"h-4 w-4"}),"Settings"]})]}),(0,t.jsx)(b,{value:"sessions",children:(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{children:"Session Management"}),(0,t.jsx)(m,{children:"Sessions are automatically created and managed during gameplay"})]}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"Sessions are automatically created when you start playing. No manual session management required!"}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,t.jsx)("p",{children:"â€¢ Sessions start automatically when you begin a story"}),(0,t.jsx)("p",{children:"â€¢ Session data is automatically saved and managed"}),(0,t.jsx)("p",{children:"â€¢ You can view session history and continue where you left off"})]})]})})]})}),(0,t.jsx)(b,{value:"characters",children:"create"===J||"edit"===J?(0,t.jsx)(en,{character:H||void 0,onSave:eb,onCancel:()=>X("list"),campaignId:F.id,sessionId:(null===(a=F.sessions)||void 0===a?void 0:null===(s=a[0])||void 0===s?void 0:s.id)||"",isSaving:ei}):"view"===J&&H?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(p,{variant:"outline",onClick:()=>X("list"),children:[(0,t.jsx)(ef.A,{className:"h-4 w-4 mr-2"}),"Back to Characters"]}),(0,t.jsx)(ep,{character:H,onEdit:()=>ev(H)})]}):(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(o,{children:"Campaign Characters"}),(0,t.jsx)(m,{children:"Manage player characters and NPCs for this campaign"})]}),(0,t.jsxs)(p,{onClick:ex,children:[(0,t.jsx)(eg.A,{className:"h-4 w-4 mr-2"}),"Add Character"]})]})}),(0,t.jsx)(h,{children:0===eh.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(ey.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"No characters in this campaign yet."}),(0,t.jsx)(p,{onClick:ex,children:"Create First Character"})]}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:eh.map(e=>(0,t.jsxs)(c,{className:"bg-card border-2 border-orange-500",children:[(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{className:"text-center text-lg",children:e.name}),(0,t.jsxs)(m,{className:"text-center",children:["Level ",e.level," ",e.race," ",e.class]})]}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"HP:"}),(0,t.jsxs)("span",{children:[e.hitPoints.current,"/",e.hitPoints.maximum]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"AC:"}),(0,t.jsx)("span",{children:e.armorClass})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,t.jsxs)(p,{size:"sm",variant:"outline",onClick:()=>ev(e),children:[(0,t.jsx)(ec.A,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,t.jsx)(p,{size:"sm",onClick:()=>eN(e),children:"View"})]})]})})]},e.id))})})]})}),(0,t.jsx)(b,{value:"locations",children:"create"===G||"edit"===G?(0,t.jsx)(ej,{location:V||void 0,onSave:eE,onCancel:()=>K("list"),availableLocations:eu,campaignId:F.id,sessionId:null===(i=F.sessions)||void 0===i?void 0:null===(n=i[0])||void 0===n?void 0:n.id,isSaving:eo}):"view"===G&&V?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)(p,{variant:"outline",onClick:()=>K("list"),children:[(0,t.jsx)(ef.A,{className:"h-4 w-4 mr-2"}),"Back to Locations"]}),(0,t.jsx)(eC,{location:V,onBack:()=>K("list"),onEdit:()=>eI(V),allLocations:eu})]}):(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(o,{children:"Campaign Locations"}),(0,t.jsx)(m,{children:"Manage locations and world-building for this campaign"})]}),(0,t.jsxs)(p,{onClick:ew,children:[(0,t.jsx)(eg.A,{className:"h-4 w-4 mr-2"}),"Add Location"]})]})}),(0,t.jsx)(h,{children:0===eu.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(el.A,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"No locations in this campaign yet."}),(0,t.jsx)(p,{onClick:ew,children:"Create First Location"})]}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:eu.map(e=>(0,t.jsxs)(c,{className:"bg-card border-2 border-orange-500",children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(o,{className:"text-lg",children:e.name}),(0,t.jsx)(v,{variant:"outline",className:"capitalize",children:e.type})]}),(0,t.jsx)(m,{children:e.description})]}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[e.inhabitants&&e.inhabitants.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-sm",children:"Inhabitants:"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.inhabitants.slice(0,2).map((e,s)=>(0,t.jsx)(v,{variant:"secondary",className:"text-xs",children:e},s)),e.inhabitants.length>2&&(0,t.jsxs)(v,{variant:"secondary",className:"text-xs",children:["+",e.inhabitants.length-2," more"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,t.jsxs)(p,{size:"sm",variant:"outline",onClick:()=>eI(e),children:[(0,t.jsx)(ec.A,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,t.jsx)(p,{size:"sm",onClick:()=>eL(e),children:"View"})]})]})})]},e.id))})})]})}),(0,t.jsx)(b,{value:"settings",children:(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{children:"Campaign Settings"}),(0,t.jsx)(m,{children:"Configure campaign rules and preferences"})]}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Basic Settings"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Difficulty"}),(0,t.jsxs)("select",{className:"w-full p-2 text-sm border rounded-md bg-background mt-1",value:Q.difficulty||"medium",onChange:e=>eT("","difficulty",e.target.value),children:[(0,t.jsx)("option",{value:"easy",children:"Easy"}),(0,t.jsx)("option",{value:"medium",children:"Medium"}),(0,t.jsx)("option",{value:"hard",children:"Hard"}),(0,t.jsx)("option",{value:"deadly",children:"Deadly"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Max Level"}),(0,t.jsx)("input",{type:"number",min:"1",max:"20",value:Q.maxLevel||20,onChange:e=>eT("","maxLevel",parseInt(e.target.value)),className:"w-full p-2 text-sm border rounded-md bg-background mt-1"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Experience Rate"}),(0,t.jsxs)("select",{className:"w-full p-2 text-sm border rounded-md bg-background mt-1",value:Q.experienceRate||"normal",onChange:e=>eT("","experienceRate",e.target.value),children:[(0,t.jsx)("option",{value:"slow",children:"Slow"}),(0,t.jsx)("option",{value:"normal",children:"Normal"}),(0,t.jsx)("option",{value:"fast",children:"Fast"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Magic Level"}),(0,t.jsxs)("select",{className:"w-full p-2 text-sm border rounded-md bg-background mt-1",value:Q.magicLevel||"medium",onChange:e=>eT("","magicLevel",e.target.value),children:[(0,t.jsx)("option",{value:"low",children:"Low"}),(0,t.jsx)("option",{value:"medium",children:"Medium"}),(0,t.jsx)("option",{value:"high",children:"High"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"AI Behavior"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Creativity"}),(0,t.jsxs)("select",{className:"w-full p-2 text-sm border rounded-md bg-background mt-1",value:(null===(l=Q.aiBehavior)||void 0===l?void 0:l.creativity)||"medium",onChange:e=>eT("aiBehavior","creativity",e.target.value),children:[(0,t.jsx)("option",{value:"low",children:"Low"}),(0,t.jsx)("option",{value:"medium",children:"Medium"}),(0,t.jsx)("option",{value:"high",children:"High"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Detail Level"}),(0,t.jsxs)("select",{className:"w-full p-2 text-sm border rounded-md bg-background mt-1",value:(null===(u=Q.aiBehavior)||void 0===u?void 0:u.detailLevel)||"moderate",onChange:e=>eT("aiBehavior","detailLevel",e.target.value),children:[(0,t.jsx)("option",{value:"minimal",children:"Minimal"}),(0,t.jsx)("option",{value:"moderate",children:"Moderate"}),(0,t.jsx)("option",{value:"detailed",children:"Detailed"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Pacing"}),(0,t.jsxs)("select",{className:"w-full p-2 text-sm border rounded-md bg-background mt-1",value:(null===(x=Q.aiBehavior)||void 0===x?void 0:x.pacing)||"normal",onChange:e=>eT("aiBehavior","pacing",e.target.value),children:[(0,t.jsx)("option",{value:"slow",children:"Slow"}),(0,t.jsx)("option",{value:"normal",children:"Normal"}),(0,t.jsx)("option",{value:"fast",children:"Fast"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Combat Style"}),(0,t.jsxs)("select",{className:"w-full p-2 text-sm border rounded-md bg-background mt-1",value:(null===(g=Q.aiBehavior)||void 0===g?void 0:g.combatStyle)||"balanced",onChange:e=>eT("aiBehavior","combatStyle",e.target.value),children:[(0,t.jsx)("option",{value:"tactical",children:"Tactical"}),(0,t.jsx)("option",{value:"balanced",children:"Balanced"}),(0,t.jsx)("option",{value:"narrative",children:"Narrative"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Player Management"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Max Players"}),(0,t.jsx)("input",{type:"number",min:"1",max:"10",value:(null===(j=Q.playerSettings)||void 0===j?void 0:j.maxPlayers)||6,onChange:e=>eT("playerSettings","maxPlayers",parseInt(e.target.value)),className:"w-full p-2 text-sm border rounded-md bg-background mt-1"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 pt-6",children:[(0,t.jsx)("input",{type:"checkbox",id:"allowNewPlayers",checked:null===(L=null===(w=Q.playerSettings)||void 0===w?void 0:w.allowNewPlayers)||void 0===L||L,onChange:e=>eT("playerSettings","allowNewPlayers",e.target.checked),className:"rounded"}),(0,t.jsx)("label",{htmlFor:"allowNewPlayers",className:"text-sm",children:"Allow New Players"})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"canCreateCharacters",checked:null===(E=null===(k=Q.playerSettings)||void 0===k?void 0:null===(C=k.playerPermissions)||void 0===C?void 0:C.canCreateCharacters)||void 0===E||E,onChange:e=>{var s;return eT("playerSettings","playerPermissions",{...null===(s=Q.playerSettings)||void 0===s?void 0:s.playerPermissions,canCreateCharacters:e.target.checked})},className:"rounded"}),(0,t.jsx)("label",{htmlFor:"canCreateCharacters",className:"text-sm",children:"Players can create characters"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"canModifyWorld",checked:null!==(D=null===(S=Q.playerSettings)||void 0===S?void 0:null===(A=S.playerPermissions)||void 0===A?void 0:A.canModifyWorld)&&void 0!==D&&D,onChange:e=>{var s;return eT("playerSettings","playerPermissions",{...null===(s=Q.playerSettings)||void 0===s?void 0:s.playerPermissions,canModifyWorld:e.target.checked})},className:"rounded"}),(0,t.jsx)("label",{htmlFor:"canModifyWorld",className:"text-sm",children:"Players can modify world"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{type:"checkbox",id:"canManageSessions",checked:null!==(T=null===(I=Q.playerSettings)||void 0===I?void 0:null===(P=I.playerPermissions)||void 0===P?void 0:P.canManageSessions)&&void 0!==T&&T,onChange:e=>{var s;return eT("playerSettings","playerPermissions",{...null===(s=Q.playerSettings)||void 0===s?void 0:s.playerPermissions,canManageSessions:e.target.checked})},className:"rounded"}),(0,t.jsx)("label",{htmlFor:"canManageSessions",className:"text-sm",children:"Players can manage sessions"})]})]})]}),es&&(0,t.jsx)("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:(0,t.jsx)("p",{className:"text-destructive text-sm",children:es})}),et&&(0,t.jsx)("div",{className:"p-3 bg-green-500/10 border border-green-500/20 rounded-lg",children:(0,t.jsx)("p",{className:"text-green-700 text-sm",children:et})}),(0,t.jsx)("div",{className:"pt-4",children:(0,t.jsx)(p,{className:"w-full",onClick:eD,disabled:$,children:$?"Saving...":"Save Settings"})})]})})]})})]})]})}var eL=a(2285),eE=a(6414),eD=a(1917);function eT(e){let{campaignId:s,characterId:a,campaigns:n,characters:i,onResumeSession:l,onStartNewSession:u,onStartNewAdventure:x}=e,[g,j]=(0,r.useState)([]),[f,y]=(0,r.useState)(!0),[N,b]=(0,r.useState)(null),w=(0,r.useCallback)(async()=>{try{y(!0),b(null);let e=await fetch("/api/sessions/active?campaignId=".concat(s));if(!e.ok)throw Error("Failed to fetch active sessions");let a=await e.json();j(a.activeSessions||[])}catch(e){b(e instanceof Error?e.message:"Failed to fetch sessions")}finally{y(!1)}},[s]);(0,r.useEffect)(()=>{w()},[s,w]);let C=e=>{let s=new Date,a=new Date(e),t=Math.floor((s.getTime()-a.getTime())/6e4);return t<1?"Just now":t<60?"".concat(t,"m ago"):t<1440?"".concat(Math.floor(t/60),"h ago"):"".concat(Math.floor(t/1440),"d ago")},k=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return e.length<=s?e:e.substring(0,s)+"..."};return f?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading active sessions..."})]}):N?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{className:"text-destructive mb-4",children:N}),(0,t.jsx)(p,{onClick:w,variant:"outline",children:"Try Again"})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(eL.A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-2",children:g.length>0?"Continue Your Adventure":"Begin Your Adventure"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:g.length>0?"You have ".concat(g.length," active session").concat(g.length>1?"s":""," to continue, or start a new adventure."):"Choose your campaign and character to start playing with your AI Dungeon Master."})]}),g.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Active Sessions"}),g.map(e=>(0,t.jsxs)(c,{className:"hover:shadow-md transition-shadow",children:[(0,t.jsx)(d,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(o,{className:"text-lg",children:e.name}),(0,t.jsx)(m,{children:e.description})]}),(0,t.jsx)(v,{variant:"secondary",children:e.status})]})}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(eE.A,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Last activity: ",C(e.lastMessageTime)]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(eL.A,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:[e.messageCount," message",1!==e.messageCount?"s":""]})]}),e.lastMessage&&(0,t.jsxs)("div",{className:"bg-muted p-3 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:["player"===e.lastMessageType?(0,t.jsx)(eh.A,{className:"h-4 w-4 text-blue-600"}):(0,t.jsx)(eD.A,{className:"h-4 w-4 text-green-600"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"player"===e.lastMessageType?"You":"Dungeon Master"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:C(e.lastMessageTime)})]}),(0,t.jsx)("p",{className:"text-sm",children:k(e.lastMessage)})]}),(0,t.jsx)("div",{className:"flex gap-2 pt-2",children:(0,t.jsxs)(p,{onClick:()=>{let s=n.find(s=>s.id===e.campaignId),t=i.find(e=>e.id===a);l(e.sessionId,s,t)},className:"flex-1",children:[(0,t.jsx)(eA.A,{className:"h-4 w-4 mr-2"}),"Resume Session"]})})]})})]},e.sessionId))]}),(0,t.jsx)("div",{className:"text-center pt-4",children:(0,t.jsxs)(p,{onClick:x,size:"lg",className:"bg-primary hover:bg-primary/90",children:[(0,t.jsx)(eA.A,{className:"h-5 w-5 mr-2"}),g.length>0?"Start New Adventure":"Start Adventure"]})})]})}function eF(e){let{onStartGame:s,onBack:a}=e,[n,i]=(0,r.useState)([]),[l,u]=(0,r.useState)([]),[x,g]=(0,r.useState)(""),[j,f]=(0,r.useState)(""),[y,N]=(0,r.useState)(!0),[b,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{N(!0),w(null);let[e]=await Promise.all([S.getCampaigns()]),s=(Array.isArray(e)?e:[]).filter(e=>"active"===e.status);i(s);let a=[];for(let e of s)try{let s=await S.getCharactersByCampaign(e.id);a.push(...s)}catch(s){console.error("Failed to fetch characters for campaign ".concat(e.id,":"),s)}u(a)}catch(e){console.error("Failed to fetch data:",e),w(e instanceof Error?e.message:"Failed to fetch data")}finally{N(!1)}})()},[]);let C=x&&j;return y?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading campaigns and characters..."})]}):b?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{className:"text-destructive mb-4",children:b}),(0,t.jsx)(p,{onClick:()=>window.location.reload(),variant:"outline",children:"Try Again"})]}):0===n.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(eL.A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"No Active Campaigns"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"You need to create a campaign first before you can start playing."}),(0,t.jsx)(p,{onClick:a,variant:"outline",children:"Back to Overview"})]}):0===l.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(eh.A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"No Characters Available"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"You need to create a character in one of your campaigns before you can start playing."}),(0,t.jsx)(p,{onClick:a,variant:"outline",children:"Back to Overview"})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(eL.A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Choose Your Adventure"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"Select your campaign and character to begin your adventure with the AI Dungeon Master."})]}),(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(eu.A,{className:"h-5 w-5"}),"Campaign Selection"]}),(0,t.jsx)(m,{children:"Choose the campaign world you want to play in"})]}),(0,t.jsx)(h,{children:(0,t.jsxs)(M,{value:x,onValueChange:e=>{g(e),f("")},children:[(0,t.jsx)(_,{children:(0,t.jsx)(B,{placeholder:"Select a campaign"})}),(0,t.jsx)(z,{children:n.map(e=>(0,t.jsx)(q,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsx)(v,{variant:"outline",className:"text-xs",children:e.theme||"Custom"})]})},e.id))})]})})]}),x&&(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)(o,{className:"flex items-center gap-2",children:[(0,t.jsx)(eh.A,{className:"h-5 w-5"}),"Character Selection"]}),(0,t.jsx)(m,{children:"Choose your character for this adventure"})]}),(0,t.jsx)(h,{children:(0,t.jsxs)(M,{value:j,onValueChange:f,children:[(0,t.jsx)(_,{children:(0,t.jsx)(B,{placeholder:"Select a character"})}),(0,t.jsx)(z,{children:l.filter(e=>e.campaignId===x).map(e=>(0,t.jsx)(q,{value:e.id,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsxs)(v,{variant:"secondary",className:"text-xs",children:["Level ",e.level," ",e.race," ",e.class]})]})},e.id))})]})})]}),(0,t.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,t.jsx)(p,{onClick:a,variant:"outline",children:"Back"}),(0,t.jsxs)(p,{onClick:()=>{if(!x||!j)return;let e=n.find(e=>e.id===x),a=l.find(e=>e.id===j);e&&a&&s(e,a)},disabled:!C,className:"bg-primary hover:bg-primary/90",children:[(0,t.jsx)(eA.A,{className:"h-4 w-4 mr-2"}),"Start Adventure"]})]}),x&&j&&(0,t.jsx)(c,{className:"bg-muted/50",children:(0,t.jsx)(h,{className:"pt-6",children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ready to begin your adventure! The AI Dungeon Master will automatically create a new session and guide you through your story."})})})})]})}let eU=r.forwardRef((e,s)=>{let{className:a,children:r,...n}=e;return(0,t.jsx)("div",{ref:s,className:l("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...n,children:r})});eU.displayName="Avatar",r.forwardRef((e,s)=>{let{className:a,children:r,...n}=e;return(0,t.jsx)("img",{ref:s,className:l("aspect-square h-full w-full",a),...n})}).displayName="AvatarImage";let eM=r.forwardRef((e,s)=>{let{className:a,children:r,...n}=e;return(0,t.jsx)("div",{ref:s,className:l("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...n,children:r})});eM.displayName="AvatarFallback";var eB=a(4089),e_=a(9268),ez=a(3645),eq=a(3850),eR=a(4089);function eO(e){let{campaign:s,character:a,currentLocation:n,onLocationChange:i,onBack:l,existingSessionId:m}=e,[u,x]=(0,r.useState)([]),[g,j]=(0,r.useState)(""),[f,y]=(0,r.useState)(!1),[N,b]=(0,r.useState)(!0),[w,C]=(0,r.useState)(!1),k=(0,r.useRef)(null),A=(0,r.useRef)(null),{executeCommand:I,isCommand:L,getSuggestions:E}=function(e,s){let[a,t]=(0,r.useState)(!1),n=(0,r.useCallback)(async(e,s)=>{try{let a=(await S.getCharactersByCampaign(s)).find(s=>s.name.toLowerCase()===e.toLowerCase());if(a)return a.id;return null}catch(e){return console.error("Error resolving character ID:",e),null}},[S]),i=(0,r.useCallback)(e=>{let s=e.trim();if(!s.startsWith("/"))return null;let a=s.split(" ");return{command:a[0].toLowerCase(),args:a.slice(1)}},[]),l=(0,r.useCallback)(async a=>{if(a.length<2)return{success:!1,content:"Usage: /character [field] [value] or /character [action] [target] [value]",type:"error"};let r=await n(e.name,s.id);if(!r)return{success:!1,content:"Error: Could not resolve character. Please refresh the page and try again.",type:"error"};let i=a[0].toLowerCase(),l=a.slice(1).join(" ");try{t(!0);let s={};switch(i){case"name":s.name=l;break;case"level":let n=parseInt(l);if(isNaN(n)||n<1||n>20)return{success:!1,content:"Level must be a number between 1 and 20",type:"error"};s.level=n;break;case"race":s.race=l;break;case"class":s.class=l;break;case"hp":if("restore"===l||"max"===l)s.hitPoints={current:e.hitPoints.maximum,maximum:e.hitPoints.maximum};else if(l.startsWith("+")||l.startsWith("-")){let a=parseInt(l);if(!isNaN(a)){let t=Math.max(0,Math.min(e.hitPoints.maximum,e.hitPoints.current+a));s.hitPoints={...e.hitPoints,current:t}}}else{let a=parseInt(l);!isNaN(a)&&a>0&&(s.hitPoints={current:a,maximum:Math.max(e.hitPoints.maximum,a)})}break;case"ac":let c=parseInt(l);if(isNaN(c)||c<0)return{success:!1,content:"Armor Class must be a positive number",type:"error"};s.armorClass=c;break;case"speed":let d=parseInt(l);if(isNaN(d)||d<0)return{success:!1,content:"Speed must be a positive number",type:"error"};s.speed=d;break;case"skill":if(a.length<3)return{success:!1,content:"Usage: /character skill [skillname] [value]",type:"error"};let o=a[1],m=a[2];"remove"===m?s.skills=e.skills.filter(e=>e!==o):e.skills.includes(o)||(s.skills=[...e.skills,o]);break;case"goal":case"fear":case"trait":case"background":s[i]=l;break;default:return{success:!1,content:"Unknown character field: ".concat(i,". Use /help character for available fields."),type:"error"}}if(Object.keys(s).length>0)try{let e=eB.env.BACKEND_URL||eB.env.NEXT_PUBLIC_API_URL;if(!e)throw Error("BACKEND_URL or NEXT_PUBLIC_API_URL environment variable is required");let a=await fetch("".concat(e,"/api/characters/").concat(r),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let t=await a.json();return{success:!0,content:"Character updated successfully: ".concat(Object.keys(s).join(", ")),type:"info",metadata:{characterInfo:t}}}catch(e){return console.error("API error during character update:",e),{success:!1,content:"Failed to update character: ".concat(e instanceof Error?e.message:"Unknown API error"),type:"error"}}}catch(e){return console.error("Error updating character:",e),{success:!1,content:"Failed to update character: ".concat(e instanceof Error?e.message:"Unknown error"),type:"error"}}finally{t(!1)}return{success:!1,content:"No valid updates to apply",type:"error"}},[e,n,s.id]),c=(0,r.useCallback)(async e=>{if(e.length<2)return{success:!1,content:"Usage: /location [field] [value] or /location [action] [target] [value]",type:"error"};let s=e[0].toLowerCase(),a=e.slice(1).join(" ");try{t(!0);let r={};switch(s){case"name":r.name=a;break;case"type":let n=["settlement","dungeon","wilderness","landmark","shop","tavern","temple","castle","other"];if(!n.includes(a))return{success:!1,content:"Invalid location type. Must be one of: ".concat(n.join(", ")),type:"error"};r.type=a;break;case"description":r.description=a;break;case"importance":let i=["minor","moderate","major","critical"];if(!i.includes(a))return{success:!1,content:"Invalid importance level. Must be one of: ".concat(i.join(", ")),type:"error"};r.importance=a;break;case"climate":r.climate=a;break;case"terrain":r.terrain=a;break;case"lighting":r.lighting=a;break;case"weather":r.weather=a;break;case"explore":r.isExplored=!0;break;case"mark-safe":r.isSafe=!0;break;case"add-tag":if(e.length<2)return{success:!1,content:"Usage: /location add-tag [tag]",type:"error"};r.tags=[e[1]];break;case"add-poi":if(e.length<3)return{success:!1,content:"Usage: /location add-poi [name] [description]",type:"error"};let l=e[1],c=e.slice(2).join(" ");r.pointsOfInterest=[{name:l,description:c,type:"landmark",isExplored:!1}];break;default:return{success:!1,content:"Unknown location field: ".concat(s,". Use /help location for available fields."),type:"error"}}if(Object.keys(r).length>0)return{success:!0,content:"Location update prepared: ".concat(Object.keys(r).join(", "),". Note: Location context needed for full update."),type:"info"};return{success:!1,content:"No valid updates to apply",type:"error"}}catch(e){return console.error("Error updating location:",e),{success:!1,content:"Failed to update location: ".concat(e instanceof Error?e.message:"Unknown error"),type:"error"}}finally{t(!1)}},[]),d=(0,r.useCallback)(async s=>{let a=i(s);if(!a)return null;let{command:t,args:r}=a;if("/character"===t)return await l(r);if("/location"===t)return await c(r);if("/help"===t){if(0===r.length)return{success:!0,content:"Available commands: /help, /roll, /status, /inventory, /character, /location. Use /help [command] for specific help.",type:"info"};let e=r[0];if("character"===e)return{success:!0,content:"Character commands: /character name [value], /character level [value], /character hp [value], /character ac [value], /character skill [skill] [value]",type:"info"};if("location"===e)return{success:!0,content:"Location commands: /location name [value], /location type [value], /location description [value], /location explore, /location add-tag [tag]",type:"info"}}switch(t){case"/roll":return{success:!0,content:"Rolling dice... (dice rolling functionality simplified)",type:"info"};case"/status":var n,d;return{success:!0,content:"Character: ".concat(e.name,", Level: ").concat(e.level,", HP: ").concat((null===(n=e.hitPoints)||void 0===n?void 0:n.current)||"N/A","/").concat((null===(d=e.hitPoints)||void 0===d?void 0:d.maximum)||"N/A",", AC: ").concat(e.armorClass||"N/A"),type:"info"};case"/inventory":let o=Array.isArray(e.equipment)?e.equipment.join(", "):"None";return{success:!0,content:"Equipment: ".concat(o),type:"info"};default:return{success:!1,content:"Unknown command: ".concat(t,". Use /help for available commands."),type:"error"}}},[e,l,c,i]),o=(0,r.useCallback)(e=>e.trim().startsWith("/"),[]),m=(0,r.useCallback)(e=>e.startsWith("/")?["/help","/roll","/status","/inventory","/character","/location"].filter(s=>s.toLowerCase().startsWith(e.toLowerCase())):[],[]),h=(0,r.useCallback)(()=>["/help","/roll","/status","/inventory","/character","/location"],[]),u=(0,r.useCallback)(e=>{switch(e.toLowerCase()){case"character":return["/character name","/character level","/character hp","/character ac","/character skill"];case"location":return["/location name","/location type","/location description","/location explore"];case"basic":return["/help","/roll","/status","/inventory"];default:return["/help","/roll","/status","/inventory","/character","/location"]}},[]);return{executeCommand:d,isCommand:o,getSuggestions:m,getAllCommands:h,getCommandsByCategory:u,getHelp:(0,r.useCallback)(()=>"Available commands: /help, /roll, /status, /inventory, /character, /location. Use /help [command] for specific help.",[]),getCommandHelp:(0,r.useCallback)(e=>({"/help":"Shows this help message. Use /help [command] for specific help.","/roll":"Rolls dice (simplified)","/status":"Shows character status and stats","/inventory":"Shows character equipment","/character":"Update character information. Use /help character for field options.","/location":"Update location information. Use /help location for field options."})[e]||"Command not found",[]),isProcessing:a}}(a,s),D=E(g),T=(0,r.useCallback)(async e=>{try{await S.createAutomaticSession(s.id,a.id,e);let t=await S.initializeCampaign(s.id,e,[a.id]);await new Promise(e=>setTimeout(e,200));let r={id:"1",sessionId:e,sender:"dm",content:t.content,timestamp:new Date,type:"message"};x([r]),b(!1)}catch(t){console.error("Failed to initialize campaign:",t);try{console.log("Retrying campaign initialization..."),await new Promise(e=>setTimeout(e,1e3));let t=await S.initializeCampaign(s.id,e,[a.id]),r={id:"1",sessionId:e,sender:"dm",content:t.content,timestamp:new Date,type:"message"};x([r]),b(!1)}catch(t){console.error("Retry failed, using minimal fallback:",t),x([{id:"1",sessionId:e,sender:"dm",content:"Welcome to ".concat(s.name,", ").concat(a.name,"! The campaign is initializing..."),timestamp:new Date,type:"message"}]),b(!1),console.error("Campaign initialization failed after retry. Please refresh the page or contact support.")}}},[s.id,a.id,s.name,a.name]),F=(0,r.useCallback)(async e=>{try{let s=await fetch("/api/sessions/".concat(e,"/messages"));if(!s.ok)throw Error("Failed to load session messages");let a=(await s.json()).messages||[];if(a.length>0)x(a);else{await T(e);return}b(!1)}catch(s){console.error("Failed to load existing session:",s);try{await T(e)}catch(e){console.error("Failed to start new session after loading failure:",e),b(!1)}}},[T]);(0,r.useEffect)(()=>{(async()=>{try{if(m)await F(m);else{let e=crypto.randomUUID();await T(e)}}catch(e){console.error("Failed to initialize campaign:",e),b(!1),console.error("Campaign initialization failed. Please refresh the page or contact support.")}})()},[s,a,n,m,F,T]),(0,r.useEffect)(()=>{k.current&&(k.current.scrollTop=k.current.scrollHeight)},[u]);let U=e=>{let s=u.length>0?u[0].sessionId:"current",a={...e,id:crypto.randomUUID(),sessionId:s,timestamp:new Date};return x(e=>[...e,a]),a},M=async()=>{if(!g.trim()||f)return;let e=g.trim();if(j(""),C(!1),L(e))try{let s=await I(e);if(s){var t;U({sender:"player",content:e,type:"action",metadata:{characterId:a.id}}),U({sender:"dm",content:s.content,type:"roll"===s.type?"roll":"message",metadata:{characterId:"system",diceRoll:null===(t=s.metadata)||void 0===t?void 0:t.diceRoll}})}return}catch(e){console.error("Error executing command:",e),U({sender:"dm",content:"Error executing command: ".concat(e instanceof Error?e.message:"Unknown error"),type:"message",metadata:{characterId:"system"}});return}U({sender:"player",content:e,type:"action",metadata:{characterId:a.id}});try{let e=u.length>0?u[0].sessionId:null;e&&await S.updateSessionActivity(e)}catch(e){console.warn("Failed to update session activity:",e)}y(!0);try{let t=eR.env.NEXT_PUBLIC_API_URL;if(!t)throw Error("API URL not configured");let r=u.length>0?u[0].sessionId:null,i=await fetch("".concat(t,"/api/gameplay/story-response"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerAction:e,campaignId:s.id,sessionId:r,characterContext:"".concat(a.name," - Level ").concat(a.level," ").concat(a.race," ").concat(a.class),worldState:n?"You are currently in ".concat(n.name,". ").concat(n.description):"You are in an unknown location, beginning your adventure."})});if(!i.ok)throw Error("HTTP error! status: ".concat(i.status));let l=await i.json();if(l.success&&l.aiResponse)U({sender:"dm",content:l.aiResponse,type:"message"}),l.discoveryMessages&&Array.isArray(l.discoveryMessages)&&l.discoveryMessages.length>0&&setTimeout(()=>{l.discoveryMessages.forEach((e,s)=>{U({sender:"system",content:e.content,type:"system-discovery",metadata:{discovery:{discoveryType:e.metadata.discoveryType,entityId:e.metadata.entityId,confidence:e.metadata.confidence,extractionMethod:e.metadata.extractionMethod,entityDetails:e.metadata.entityDetails,isNew:e.metadata.isNew}}})})},500);else throw Error("Invalid response format")}catch(e){console.error("AI request failed:",e),U({sender:"dm",content:"I apologize, but I encountered an error while processing your request. Please try again.",type:"message"})}finally{y(!1)}},B=e=>{var s;e&&j("/".concat(e," ")),C(!1),null===(s=A.current)||void 0===s||s.focus()},_=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return(0,t.jsxs)("div",{className:"flex flex-col h-[600px] md:h-[600px] max-w-4xl mx-auto",children:[(0,t.jsx)("div",{className:"mb-0",children:(0,t.jsxs)(p,{variant:"outline",size:"sm",onClick:l,className:"h-7 md:h-8 px-2 md:px-3",children:[(0,t.jsx)(ef.A,{className:"h-3 w-3 md:h-4 md:w-4 mr-1 md:mr-2"}),(0,t.jsx)("span",{className:"text-xs md:text-sm",children:"Back to Game Session"})]})}),(0,t.jsx)(c,{className:"mb-0",children:(0,t.jsx)(d,{className:"py-0 px-2 md:px-4",children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-1 md:gap-0",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(o,{className:"text-sm md:text-lg leading-tight",children:s.name}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-0.5 sm:gap-2 text-xs md:text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{className:"font-medium text-xs md:text-sm",children:[a.name," - Level ",a.level," ",a.race," ",a.class]}),n&&(0,t.jsxs)(v,{variant:"outline",className:"capitalize flex items-center gap-1 w-fit text-xs",children:[(0,t.jsx)(el.A,{className:"h-2 w-2 md:h-3 md:w-3"}),n.name]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 md:gap-3 text-xs",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(ed.A,{className:"h-2 w-2 md:h-3 md:w-3 text-red-500"}),(0,t.jsxs)("span",{className:"text-xs",children:[a.hitPoints.current,"/",a.hitPoints.maximum]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(eo.A,{className:"h-2 w-2 md:h-3 md:w-3 text-blue-500"}),(0,t.jsx)("span",{className:"text-xs",children:a.armorClass})]})]})]})})}),(0,t.jsxs)(c,{className:"flex-1 flex flex-col min-h-0",children:[(0,t.jsx)(d,{className:"py-0 flex-shrink-0 px-2 md:px-6",children:(0,t.jsxs)(o,{className:"text-sm md:text-lg flex items-center gap-2",children:[(0,t.jsx)(eD.A,{className:"h-3 w-3 md:h-5 md:w-5"}),"Adventure Chat",(f||N)&&(0,t.jsx)(v,{variant:"secondary",className:"text-xs",children:N?"Initializing...":"AI Thinking..."})]})}),(0,t.jsxs)(h,{className:"flex-1 flex flex-col p-0 min-h-0",children:[(0,t.jsx)("div",{className:"flex-1 px-3 md:px-4 overflow-y-auto",style:{height:"500px",maxHeight:"500px"},ref:k,children:(0,t.jsxs)("div",{className:"space-y-2 md:space-y-4 pb-2",children:[u.map(e=>{var s;return(0,t.jsxs)("div",{className:"flex gap-2 md:gap-3 ".concat("player"===e.sender?"flex-row-reverse":""),children:[(0,t.jsx)(eU,{className:"h-6 w-6 md:h-8 md:w-8",children:(0,t.jsx)(eM,{children:"dm"===e.sender?(0,t.jsx)(eD.A,{className:"h-3 w-3 md:h-4 md:w-4"}):"system"===e.sender?(0,t.jsx)(el.A,{className:"h-3 w-3 md:h-4 md:w-4"}):(0,t.jsx)(eh.A,{className:"h-3 w-3 md:h-4 md:w-4"})})}),(0,t.jsxs)("div",{className:"flex-1 max-w-[80%] ".concat("player"===e.sender?"text-right":""),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"text-xs md:text-sm font-medium",children:"dm"===e.sender?"Dungeon Master":"system"===e.sender?"System":a.name}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:_(e.timestamp)}),"roll"===e.type&&(0,t.jsxs)(v,{variant:"secondary",className:"text-xs",children:[(0,t.jsx)(e_.A,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Roll"]}),"action"===e.type&&(0,t.jsxs)(v,{variant:"outline",className:"text-xs",children:[(0,t.jsx)(eu.A,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Action"]}),"system-discovery"===e.type&&(0,t.jsxs)(v,{variant:"default",className:"text-xs bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(el.A,{className:"h-2 w-2 md:h-3 md:w-3 mr-1"}),"Discovery"]})]}),(0,t.jsx)("div",{className:"p-2 md:p-3 rounded-lg ".concat("dm"===e.sender?"bg-muted":"system"===e.sender?"bg-green-50 border border-green-200 dark:bg-green-950 dark:border-green-800":(e.type,"bg-primary text-primary-foreground")),children:"system-discovery"===e.type?(0,t.jsxs)("div",{className:"text-xs md:text-sm",children:[(0,t.jsx)("div",{className:"whitespace-pre-wrap text-green-800 dark:text-green-200",children:e.content.split("\n").map((e,s)=>{if(e.includes("\uD83C\uDD95 New Character Discovered:")||e.includes("\uD83C\uDD95 New Location Discovered:")||e.includes("\uD83C\uDD95 **New Character Discovered**:")||e.includes("\uD83C\uDD95 **New Location Discovered**:")){let a,r;let[n,...i]=e.split(" ");return e.includes("**")?(a=i.slice(1,4).join(" "),r=i.slice(4).join(" ")):(a=i.slice(0,3).join(" "),r=i.slice(3).join(" ")),(0,t.jsxs)("div",{className:"mb-1",children:[(0,t.jsx)("span",{className:"text-lg",children:n})," ",(0,t.jsx)("span",{className:"font-bold",children:a})," ",(0,t.jsx)("span",{className:"font-semibold text-green-900 dark:text-green-100",children:r})]},s)}return e.trim().startsWith("â€¢")?(0,t.jsx)("div",{className:"ml-3",children:e},s):(0,t.jsx)("div",{children:e},s)})}),(null===(s=e.metadata)||void 0===s?void 0:s.discovery)&&(0,t.jsx)("div",{className:"mt-2 pt-2 border-t border-green-200 dark:border-green-800",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs text-green-600 dark:text-green-400",children:[(0,t.jsxs)("span",{children:["Confidence:"," ",e.metadata.discovery.confidence,"%"]}),(0,t.jsx)("span",{children:"â€¢"}),(0,t.jsxs)("span",{children:["Method:"," ",e.metadata.discovery.extractionMethod]}),e.metadata.discovery.isNew&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"â€¢"}),(0,t.jsx)("span",{className:"text-green-700 dark:text-green-300 font-medium",children:"NEW!"})]})]})})]}):(0,t.jsx)("p",{className:"text-xs md:text-sm whitespace-pre-wrap",children:e.content})})]})]},e.id)}),(f||N)&&(0,t.jsxs)("div",{className:"flex gap-2 md:gap-3",children:[(0,t.jsx)(eU,{className:"h-6 w-6 md:h-8 md:w-8",children:(0,t.jsx)(eM,{children:(0,t.jsx)(eD.A,{className:"h-3 w-3 md:h-4 md:w-4"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("span",{className:"text-xs md:text-sm font-medium",children:"Dungeon Master"}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:N?"initializing campaign...":"thinking..."})]}),(0,t.jsx)("div",{className:"p-2 md:p-3 bg-muted rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"}),(0,t.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,t.jsx)("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]})]})]})}),(0,t.jsx)("div",{className:"border-t p-1 md:p-4 flex-shrink-0 relative pb-0",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(P,{ref:A,value:g,onChange:e=>{let s=e.target.value;j(s),s.startsWith("/")&&s.length>1?C(!0):C(!1)},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M())},placeholder:N?"Initializing campaign...":"Describe your action or use /help for commands...",disabled:f||N,className:"flex-1 text-sm md:text-base"}),g.startsWith("/")&&(0,t.jsx)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:(0,t.jsx)(ez.A,{className:"h-3 w-3 md:h-4 md:w-4 text-muted-foreground"})}),w&&D.length>0&&(0,t.jsx)("div",{className:"absolute top-full left-0 right-0 bg-background border rounded-md shadow-lg z-10 max-h-48 overflow-y-auto",children:D.map((e,s)=>(0,t.jsx)("button",{onClick:()=>B(e),className:"w-full text-left px-3 py-2 hover:bg-muted text-sm",children:e},s))})]}),(0,t.jsx)(p,{onClick:M,disabled:!g.trim()||f||N,size:"sm",className:"h-8 md:h-10 px-2 md:px-3",children:(0,t.jsx)(eq.A,{className:"h-3 w-3 md:h-4 md:w-4"})})]})})]})]})]})}function eH(e){let{campaign:s,characters:a,onResumeSession:n}=e,[i,l]=(0,r.useState)([]),[u,x]=(0,r.useState)(!0),[g,j]=(0,r.useState)(null),f=a.find(e=>e.campaignId===s.id),y=(0,r.useCallback)(async()=>{if(null==s?void 0:s.id){x(!0),j(null);try{let e=await fetch("/api/sessions/active?campaignId=".concat(s.id));if(!e.ok)throw Error("Failed to fetch active sessions");let a=await e.json();l(a.sessions||[])}catch(e){j(e instanceof Error?e.message:"An error occurred")}finally{x(!1)}}},[null==s?void 0:s.id]);(0,r.useEffect)(()=>{y()},[y]);let N=e=>{let s=new Date,a=new Date(e),t=Math.floor((s.getTime()-a.getTime())/6e4);return t<1?"Just now":t<60?"".concat(t,"m ago"):t<1440?"".concat(Math.floor(t/60),"h ago"):"".concat(Math.floor(t/1440),"d ago")};return u?(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{className:"text-lg",children:s.name})}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading sessions..."})]})})]}):g?(0,t.jsxs)(c,{children:[(0,t.jsx)(d,{children:(0,t.jsx)(o,{className:"text-lg",children:s.name})}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)("p",{className:"text-sm text-destructive mb-2",children:g}),(0,t.jsx)(p,{onClick:y,variant:"outline",size:"sm",children:"Try Again"})]})})]}):(0,t.jsxs)(c,{children:[(0,t.jsxs)(d,{children:[(0,t.jsx)(o,{className:"text-lg",children:s.name}),(0,t.jsx)(m,{children:s.description})]}),(0,t.jsx)(h,{children:i.length>0?(0,t.jsx)("div",{className:"space-y-3",children:i.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsx)("h4",{className:"font-medium",children:e.name}),(0,t.jsx)(v,{variant:"active"===e.status?"default":"secondary",children:e.status})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(eE.A,{className:"h-3 w-3"}),N(e.lastMessageTime)]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(eL.A,{className:"h-3 w-3"}),e.messageCount," messages"]})]})]}),(0,t.jsxs)(p,{onClick:()=>n(e.sessionId,s,f||a[0]),size:"sm",className:"ml-4",disabled:!f&&0===a.length,children:[(0,t.jsx)(eA.A,{className:"h-4 w-4 mr-2"}),"Continue"]})]},e.sessionId))}):(0,t.jsxs)("div",{className:"text-center py-6",children:[(0,t.jsx)(eL.A,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No active sessions for this campaign"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Create a new session from the campaign management to start playing"})]})})]})}let eW="force-dynamic";function eV(){let[e,s]=(0,r.useState)([]),[a,n]=(0,r.useState)([]),[i,l]=(0,r.useState)([]),[u,x]=(0,r.useState)(null),[g,j]=(0,r.useState)(null),[w,C]=(0,r.useState)(null),[k,A]=(0,r.useState)("overview"),[P,I]=(0,r.useState)("campaigns"),[L,E]=(0,r.useState)(!0),[D,T]=(0,r.useState)(null),[F,U]=(0,r.useState)(null),[M,B]=(0,r.useState)(null),[_,z]=(0,r.useState)(!1),[q,R]=(0,r.useState)(!1),[O,H]=(0,r.useState)(!1),[W,V]=(0,r.useState)(0),Y=()=>{V(e=>e+1)};(0,r.useEffect)(()=>{(async()=>{try{E(!0),T(null);let[e]=await Promise.all([S.getCampaigns()]),a=Array.isArray(e)?e:[];s(a);let t=[],r=a.filter(e=>"active"===e.status);if(r.length>0)try{let e=r.map(async e=>{try{let s=await S.getCharactersByCampaign(e.id);return Array.isArray(s)?s:[]}catch(s){return console.error("Failed to fetch characters for campaign ".concat(e.id,":"),s),[]}});(await Promise.all(e)).forEach(e=>{Array.isArray(e)&&t.push(...e)})}catch(e){console.error("Failed to fetch characters:",e)}n(t)}catch(e){console.error("Failed to fetch data:",e),T(e instanceof Error?e.message:"Failed to fetch data"),s([]),n([])}finally{E(!1)}})()},[]);let J=()=>{x(null),A("create-campaign")},X=e=>{x(e||null),A("edit-campaign")},G=async a=>{try{if(z(!0),T(null),u){let t=await S.updateCampaign(u.id,a);s(e.map(e=>e.id===u.id?t:e))}else{let t=await S.createCampaign(a);s([...e,t])}A("overview"),x(null)}catch(e){throw console.error("Failed to save campaign:",e),T(e instanceof Error?e.message:"Failed to save campaign"),e}finally{z(!1)}},K=e=>{x(e),A("campaign-detail"),S.getLocationsByCampaign(e.id).then(e=>{l(e)}).catch(e=>{console.error("Failed to fetch campaign locations:",e),l([])})},Q=async a=>{if(confirm('Are you sure you want to delete "'.concat(a.name,'"? This action cannot be undone.')))try{await S.deleteCampaign(a.id),s(e.filter(e=>e.id!==a.id)),T(null)}catch(e){console.error("Failed to delete campaign:",e),T(e instanceof Error?e.message:"Failed to delete campaign")}},$=()=>{A("overview"),x(null),j(null),C(null)},ee=async e=>{try{if(R(!0),T(null),g){let s=await S.updateCharacter(g.id,e);n(a.map(e=>e.id===g.id?s:e))}else{let s=await S.createCharacter(e);n([...a,s]),A("overview"),j(null)}}catch(e){throw console.error("Failed to save character:",e),T(e instanceof Error?e.message:"Failed to save character"),e}finally{R(!1)}},es=async e=>{try{if(H(!0),T(null),w){let s=await S.updateLocation(w.id,e);l(i.map(e=>e.id===w.id?s:e))}else{let s=await S.createLocation(e);l([...i,s])}}catch(e){throw console.error("Failed to save location:",e),T(e instanceof Error?e.message:"Failed to save location"),e}finally{H(!1)}},ea=(e,s)=>{B({campaign:e,character:s}),A("session-continuity")},et=e=>{j(e),A("edit-character")},er=e=>{j(e),A("character-sheet")},ei=e=>{C(e),A("edit-location")},el=(e,s,a)=>{if(s&&a){U({campaign:s,character:a,sessionId:e}),A("gameplay");return}M?(U({...M,sessionId:e}),A("gameplay")):console.warn("Cannot resume session: missing campaign or character information")},ec=async(e,s)=>{try{let a=await S.createAutomaticSession(e.id,s.id,crypto.randomUUID());U({campaign:e,character:s,sessionId:a.session._id||a.session.id}),Y(),A("gameplay")}catch(e){console.error("Failed to create automatic session:",e),alert("Failed to create session. Please try again.")}};return"create-campaign"===k||"edit-campaign"===k?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-6 w-6 text-primary-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:u?"Edit Campaign":"Create Campaign"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)(Z,{campaign:u||void 0,onSave:G,onCancel:$,isSaving:_})})]}):"create-character"===k||"edit-character"===k?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-6 w-6 text-primary-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:g?"Edit Character":"Create Character"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)(en,{character:g||void 0,onSave:ee,onCancel:$,isSaving:q,campaigns:e})})]}):"character-sheet"===k?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-6 w-6 text-primary-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Character Sheet"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)(ep,{character:g,onBack:$,onEdit:()=>et(g)})})]}):"create-location"===k||"edit-location"===k?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-6 w-6 text-primary-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:w?"Edit Location":"Create Location"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)(ej,{location:w||void 0,onSave:es,onCancel:$,isSaving:O})})]}):"location-detail"===k?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Location Details"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)(eC,{location:w,onBack:$,onEdit:()=>ei(w)})})]}):"campaign-detail"===k?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-6 w-6 text-primary-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Campaign Management"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)(eI,{campaign:u,characters:a,locations:i,onBack:$,onEdit:()=>X(u),onPlaySession:s=>{if(s.campaignId){let t=e.find(e=>e.id===s.campaignId);t&&(a.filter(e=>e.campaignId===t.id).length>0?A("campaign-character-selector"):ea(t,a[0]))}},onSaveCharacter:ee,onSaveLocation:es,onDeleteCampaign:Q})})]}):"campaign-character-selector"===k?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-6 w-6 text-primary-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Choose Your Adventure"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,t.jsx)(eF,{onStartGame:ec,onBack:()=>A("overview")})})]}):"session-continuity"===k?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Session Continuity"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:M?(0,t.jsx)(eT,{campaignId:M.campaign.id,characterId:M.character.id,campaigns:e,characters:a,onResumeSession:el,onStartNewSession:()=>{e.length>0&&a.length>0?A("campaign-character-selector"):J()},onStartNewAdventure:()=>{A("campaign-character-selector")}}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"No session continuity data found."}),(0,t.jsx)(p,{onClick:()=>A("overview"),className:"mt-4",children:"Back to Overview"})]})})]}):"gameplay"===k?(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Adventure in Progress"})]})]})})}),(0,t.jsx)("div",{className:"container mx-auto px-4 py-8",children:F?(0,t.jsx)(eO,{campaign:F.campaign,character:F.character,onBack:()=>A("session-continuity"),existingSessionId:F.sessionId}):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"No active game session found."}),(0,t.jsx)(p,{onClick:()=>A("session-continuity"),className:"mt-4",children:"Back to Session Continuity"})]})})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,t.jsx)("header",{className:"border-b border-border bg-card",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-primary rounded-lg",children:(0,t.jsx)(eu.A,{className:"h-4 w-4"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"AI Dungeons & Dragons"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Your AI-powered tabletop adventure"})]})]}),(0,t.jsxs)(p,{className:"bg-primary hover:bg-primary/90",onClick:J,children:[(0,t.jsx)(eg.A,{className:"h-4 w-4 mr-2"}),"New Campaign"]})]})})}),(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[D&&(0,t.jsxs)("div",{className:"mb-6 p-4 bg-destructive/10 border border-destructive/20 rounded-lg",children:[(0,t.jsx)("p",{className:"text-destructive text-sm",children:D}),(0,t.jsx)(p,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>T(null),children:"Dismiss"})]}),L&&(0,t.jsxs)("div",{className:"mb-6 p-8 text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})]}),!Array.isArray(e)&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:(0,t.jsx)("p",{className:"text-yellow-700 text-sm",children:"Campaigns data is not properly initialized"})}),(0,t.jsxs)(f,{value:P,onValueChange:I,className:"space-y-6",children:[(0,t.jsxs)(y,{className:"grid w-full grid-cols-3",children:[(0,t.jsxs)(N,{value:"campaigns",className:"flex items-center gap-2",children:[(0,t.jsx)(eu.A,{className:"h-4 w-4"}),"Campaigns"]}),(0,t.jsxs)(N,{value:"characters",className:"flex items-center gap-2",children:[(0,t.jsx)(eh.A,{className:"h-4 w-4"}),"Characters"]}),(0,t.jsxs)(N,{value:"play",className:"flex items-center gap-2",children:[(0,t.jsx)(eA.A,{className:"h-4 w-4"}),"Play"]})]}),(0,t.jsxs)(b,{value:"campaigns",className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-3xl font-bold text-foreground",children:"Your Campaigns"}),(0,t.jsxs)(p,{variant:"outline",onClick:J,children:[(0,t.jsx)(eg.A,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})]}),(0,t.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:Array.isArray(e)&&e.length>0?e.map(e=>e&&(0,t.jsxs)(c,{className:"bg-card border-2 border-orange-500 hover:shadow-lg hover:shadow-primary/10 transition-all cursor-pointer",children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(o,{className:"text-xl",children:e.name||"Unnamed Campaign"}),(0,t.jsx)(v,{variant:"active"===e.status?"default":"secondary",children:"active"===e.status?"Active":e.status})]}),(0,t.jsx)(m,{children:e.description||"No description"})]}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:(null==e?void 0:e.theme)||"Custom Setting"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(p,{size:"sm",variant:"outline",onClick:()=>X(e),children:"Edit"}),(0,t.jsxs)(p,{size:"sm",onClick:()=>K(e),children:[(0,t.jsx)(eA.A,{className:"h-4 w-4 mr-2"}),"Manage"]}),(0,t.jsx)(p,{size:"sm",variant:"destructive",onClick:()=>Q(e),children:(0,t.jsx)(ek.A,{className:"h-4 w-4"})})]})]})})]},e.id||"campaign-".concat(Math.random()))):(0,t.jsx)("div",{className:"col-span-full text-center py-12",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"No campaigns yet. Create your first campaign to get started!"})})})]}),(0,t.jsxs)(b,{value:"characters",className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-3xl font-bold text-foreground",children:"Your Characters"}),(0,t.jsxs)(p,{variant:"outline",onClick:()=>A("create-character"),children:[(0,t.jsx)(eg.A,{className:"h-4 w-4 mr-2"}),"Create Character"]})]}),(0,t.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:Array.isArray(a)&&a.length>0?a.map(s=>{var a;return s&&(0,t.jsxs)(c,{className:"bg-card border-2 border-blue-500 hover:shadow-lg hover:shadow-primary/10 transition-all cursor-pointer",children:[(0,t.jsxs)(d,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(o,{className:"text-xl",children:s.name||"Unnamed Character"}),(0,t.jsx)(v,{variant:"active"===s.status?"default":"secondary",children:"active"===s.status?"Active":s.status})]}),(0,t.jsx)(m,{children:s.description||"No description"})]}),(0,t.jsx)(h,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:(null===(a=e.find(e=>e.id===s.campaignId))||void 0===a?void 0:a.name)||"No Campaign"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(p,{size:"sm",variant:"outline",onClick:()=>et(s),children:"Edit"}),(0,t.jsxs)(p,{size:"sm",onClick:()=>er(s),children:[(0,t.jsx)(eA.A,{className:"h-4 w-4 mr-2"}),"View"]})]})]})})]},s.id||"character-".concat(Math.random()))}):(0,t.jsx)("div",{className:"col-span-full text-center py-12",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"No characters yet. Create your first character to get started!"})})})]}),(0,t.jsx)(b,{value:"play",className:"space-y-6",children:e.length>0?(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsx)(eL.A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Ready to Play?"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"Choose your campaign and character to start your adventure."}),(0,t.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,t.jsxs)(p,{onClick:()=>A("campaign-character-selector"),className:"bg-primary hover:bg-primary/90",children:[(0,t.jsx)(eA.A,{className:"h-4 w-4 mr-2"}),"Start Adventure"]}),a.length>0&&(0,t.jsxs)(p,{onClick:()=>ea(e[0],a[0]),variant:"outline",children:[(0,t.jsx)(eL.A,{className:"h-4 w-4 mr-2"}),"Continue Adventure"]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Active Sessions"}),e.map(e=>(0,t.jsx)(eH,{campaign:e,characters:a,onResumeSession:el},"".concat(e.id,"-").concat(W)))]})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(eL.A,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"Begin Your Adventure"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"Create a campaign and character to start playing with your AI Dungeon Master. The AI will guide your story and play all the NPCs you encounter."}),(0,t.jsxs)(p,{size:"lg",className:"bg-primary hover:bg-primary/90",onClick:J,children:[(0,t.jsx)(eg.A,{className:"h-5 w-5 mr-2"}),"Create Campaign"]})]})})]})]})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[140,347,870,358],()=>s(898)),_N_E=e.O()}]);